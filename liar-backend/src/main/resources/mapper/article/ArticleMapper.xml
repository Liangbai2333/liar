<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="site.liangbai.liar.mapper.article.ArticleMapper">

    <!-- 定义 Category 的 ResultMap -->
    <resultMap id="CategoryResultMap" type="site.liangbai.liar.entity.dto.article.Category">
        <id property="id" column="category_id"/>
        <result property="name" column="category_name"/>
        <result property="description" column="category_description"/>
        <result property="icon" column="category_icon"/>
        <result property="color" column="category_color"/>
        <result property="createTime" column="category_create_time"/>
        <result property="updateTime" column="category_update_time"/>
    </resultMap>

    <!-- 定义 Article 的 ResultMap -->
    <resultMap id="ArticleResultMap" type="site.liangbai.liar.entity.dto.article.Article">
        <id property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="summary" column="summary"/>
        <result property="motto" column="motto"/>
        <result property="content" column="content"/>
        <result property="cover" column="cover"/>
        <result property="views" column="views"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <!-- 关联 Category -->
        <association property="category" resultMap="CategoryResultMap"/>
    </resultMap>

    <!-- 查询 Article 并级联查询 Category -->
    <select id="getArticleById" resultMap="ArticleResultMap" parameterType="int">
        SELECT
            a.id,
            a.title,
            a.summary,
            a.motto,
            a.content,
            a.cover,
            a.category_id,
            a.views,
            a.create_time,
            a.update_time,
            c.name AS category_name,
            c.description AS category_description,
            c.icon AS category_icon,
            c.color AS category_color,
            c.create_time AS category_create_time,
            c.update_time AS category_update_time
        FROM articles a
        LEFT JOIN categories c ON a.category_id = c.id
        WHERE a.id = #{id}
    </select>
</mapper>
